<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimating Autocorrelation of Colored Noise • colorednoise</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Estimating Autocorrelation of Colored Noise">
<meta property="og:description" content="colorednoise">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">colorednoise</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/noise.html">Estimating Autocorrelation of Colored Noise</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/japilo/colorednoise/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="noise_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Estimating Autocorrelation of Colored Noise</h1>
                        <h4 class="author">Julia Pilowsky</h4>
            
            <h4 class="date">2020-10-08</h4>
      
      <small class="dont-index">Source: <a href="http://github.com/japilo/colorednoise/blob/master/vignettes/noise.Rmd"><code>vignettes/noise.Rmd</code></a></small>
      <div class="hidden name"><code>noise.Rmd</code></div>

    </div>

    
    
<div id="what-is-colored-noise" class="section level2">
<h2 class="hasAnchor">
<a href="#what-is-colored-noise" class="anchor"></a>What is colored noise?</h2>
<p>Expressed in plain words, colored noise is a stochastic process wherein values tend to be correlated with other values nearby in space or time. Colored noise in spatial data sets is said to be spatially autocorrelated, while colored noise in time series is said to be temporally autocorrelated. In this package we only deal with the latter.</p>
<p>Expressed in math, colored noise can be modeled with the following equation, where <span class="math inline">\(\omega\)</span> is a random standard normal variable, and <span class="math inline">\(\epsilon\)</span> is a temporally autocorrelated variable:</p>
<p><span class="math inline">\(\epsilon_{t + 1} = k\epsilon_t + \omega_t\sqrt{1 - k^2}\)</span></p>
<p>Mathematically, we can also think of unautocorrelated stochasticity as random sine waves evenly distributed across all wavelengths, while autocorrelated stochasticity is biased either toward sine waves of long wavelengths (red) or short wavelengths (blue).</p>
<p>Expressed graphically, colored noise looks like this:</p>
<p><img src="noise_files/figure-html/comparing%20red%20and%20blue%20noise-1.png" width="700"><img src="noise_files/figure-html/comparing%20red%20and%20blue%20noise-2.png" width="700"></p>
<p>In the blue noise plot above, each random number is negatively correlated to the one preceding it. In the red noise plot, each random number is positively correlated to the one preceding it.</p>
</div>
<div id="example-bias-and-precision-of-autocorrelation-estimates" class="section level2">
<h2 class="hasAnchor">
<a href="#example-bias-and-precision-of-autocorrelation-estimates" class="anchor"></a>Example: Bias and precision of autocorrelation estimates</h2>
<p>To show you how you can use this package to simulate and analyze colored noise, I will present a problem for us to solve. Let’s say we want to find out whether our estimates of temporal autocorrelation are biased when the standard deviation of the colored noise is high. First, let’s use the <code>raw_noise</code> function to generate some colored noise with high variance.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="va">red</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/colored_noise.html">colored_noise</a></span><span class="op">(</span>timesteps <span class="op">=</span> <span class="fl">100</span>, mean <span class="op">=</span> <span class="fl">0.3</span>, sd <span class="op">=</span> <span class="fl">1.2</span>, phi <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
<span class="va">red</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>
<span class="co">#&gt;  [1] -3.3556902 -2.6656854 -2.1272799  0.9793865  1.8727956  0.8286511</span>
<span class="co">#&gt;  [7] -0.7089789  2.0338977  0.4539040  1.9070181</span>
<span class="va">blue</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/colored_noise.html">colored_noise</a></span><span class="op">(</span>timesteps <span class="op">=</span> <span class="fl">100</span>, mean <span class="op">=</span> <span class="fl">0.3</span>, sd <span class="op">=</span> <span class="fl">1.2</span>, phi <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span>
<span class="va">blue</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>
<span class="co">#&gt;  [1]  0.4708098  0.4779904  0.7116479 -0.9150298  4.2168258 -0.6592254</span>
<span class="co">#&gt;  [7]  0.6400465 -1.0357057  0.8387268  1.6858232</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">blue</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span>color<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Blue Noise"</span><span class="op">)</span></pre></div>
<p><img src="noise_files/figure-html/generate%20noise-1.png" width="700"></p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">red</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span>color<span class="op">=</span><span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Red Noise"</span><span class="op">)</span></pre></div>
<p><img src="noise_files/figure-html/generate%20noise-2.png" width="700"></p>
<p>The red noise and blue noise look the way they should. Now let’s estimate the mean, SD, and autocorrelation of these two sets of random numbers to see how well they match the parameters we used to generate them.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu">invoke_map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">mean</span>, <span class="va">sd</span>, <span class="va">autocorrelation</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">red</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] 0.2771024</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] 1.306311</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] 0.4317427</span>
<span class="fu">invoke_map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">mean</span>, <span class="va">sd</span>, <span class="va">autocorrelation</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">blue</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] 0.4710391</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] 1.191427</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] -0.4948799</span></pre></div>
<p>The estimates for these seem to be quite accurate. But let’s try generating a whole lot of colored noise across a range of variance and color and estimating the autocorrelation of each replicate.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="va">raw_sims</span> <span class="op">&lt;-</span> <span class="fu">cross_df</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>timesteps <span class="op">=</span> <span class="fl">20</span>, phi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fl">0.3</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.9</span>, <span class="fl">1.1</span>, <span class="fl">1.3</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">rerun</span><span class="op">(</span>.n <span class="op">=</span> <span class="fl">30</span>, <span class="fu">pmap</span><span class="op">(</span><span class="va">.</span>, <span class="va">colored_noise</span><span class="op">)</span><span class="op">)</span>
<span class="va">labels</span> <span class="op">&lt;-</span> <span class="va">raw_sims</span> <span class="op">%&gt;%</span> <span class="fu">map</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbindlist</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">noise</span> <span class="op">&lt;-</span> <span class="va">raw_sims</span> <span class="op">%&gt;%</span> <span class="fu">map</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">flatten</span><span class="op">(</span><span class="op">)</span>
<span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="va">noise</span>, <span class="va">mean</span><span class="op">)</span>, sigma <span class="op">=</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="va">noise</span>, <span class="va">sd</span><span class="op">)</span>, autocorrelation <span class="op">=</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="va">noise</span>, <span class="va">autocorrelation</span><span class="op">)</span><span class="op">)</span>
<span class="va">sd_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">labels</span>, <span class="va">estimates</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sd_range</span><span class="op">)</span>
<span class="co">#&gt;    timesteps  phi mean  sd        mu     sigma autocorrelation</span>
<span class="co">#&gt; 1:        20 -0.5  0.3 0.5 0.3620196 0.5337716     -0.50719389</span>
<span class="co">#&gt; 2:        20  0.0  0.3 0.5 0.5682215 0.5293456      0.01135706</span>
<span class="co">#&gt; 3:        20  0.5  0.3 0.5 0.5752618 0.3305384      0.57798690</span>
<span class="co">#&gt; 4:        20 -0.5  0.3 0.7 0.1253258 0.6800782     -0.44375225</span>
<span class="co">#&gt; 5:        20  0.0  0.3 0.7 0.1635260 0.6481182     -0.31746752</span>
<span class="co">#&gt; 6:        20  0.5  0.3 0.7 0.2015518 0.5212291      0.35049626</span></pre></div>
<p>We can visualize these results by finding the mean and confidence intervals of the autocorrelation estimates for each combination of variance and noise color, and plotting them out.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">summ</span> <span class="op">&lt;-</span> <span class="va">sd_range</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>lower.ci <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">bar</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">bar</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="va">autocorrelation</span><span class="op">)</span><span class="op">)</span>, upper.ci <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">bar</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">bar</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
<span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="va">autocorrelation</span><span class="op">)</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">autocorrelation</span><span class="op">)</span><span class="op">)</span>, keyby <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">phi</span>, 
    <span class="va">sd</span><span class="op">)</span><span class="op">]</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">summ</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">sd</span>, y <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_pointrange</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower.ci</span>, ymax <span class="op">=</span> <span class="va">upper.ci</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">phi</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"#C0C0C0"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, linetype <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"#0033FF"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.5</span>, linetype <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"#CC0000"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>text<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Standard Deviation"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Estimated Autocorrelation"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#0033FF"</span>, <span class="st">"#C0C0C0"</span>, <span class="st">"#CC0000"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>color<span class="op">=</span><span class="st">"Noise color"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span></pre></div>
<p><img src="noise_files/figure-html/plot%20CIs-1.png" width="700"></p>
<p>As we can see, the variance of the colored noise does not seem to affect the estimates of autocorrelation in any case. However, another interesting pattern emerges: the estimates of autocorrelation for red noise (phi = 0.5) are consistently biased too low. This may be because the number of timesteps we simulated (20) is too short to get a full measurement of the long wavelengths of red noise.</p>
<p>Let’s explore this possibility further.</p>
</div>
<div id="example-estimating-autocorrelation-in-colored-noise-populations" class="section level2">
<h2 class="hasAnchor">
<a href="#example-estimating-autocorrelation-in-colored-noise-populations" class="anchor"></a>Example: Estimating autocorrelation in colored noise populations</h2>
<p>We now suspect, based on estimates of colored noise, that long time series are required in order to detect positive temporal autocorrelation without bias. However, the problem becomes even more complex when we use colored noise to simulate populations. Now, the environmental stochasticity we’re modeling as colored noise is compounded by demographic stochasticity, the random drift resulting from the discrete probability distribution of births and deaths, especially in small populations.</p>
<p>To give an example of what I mean, let’s model a small population with positively autocorrelated environmental stochasticity. This population is closed (no migration), assumes constant fertility and mortality for all individuals, and can be thought of as asexually reproducing or female-only.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">3935</span><span class="op">)</span>
<span class="va">series1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unstructured_pop.html">unstructured_pop</a></span><span class="op">(</span>start<span class="op">=</span><span class="fl">20</span>, timesteps<span class="op">=</span><span class="fl">20</span>, survPhi<span class="op">=</span><span class="fl">0.4</span>, fecundPhi<span class="op">=</span><span class="fl">0.4</span>, survMean<span class="op">=</span><span class="fl">0.5</span>, survSd<span class="op">=</span><span class="fl">0.2</span>, fecundMean<span class="op">=</span><span class="fl">1</span>, fecundSd<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">series1</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">timestep</span>, y<span class="op">=</span><span class="va">population</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></pre></div>
<p><img src="noise_files/figure-html/model%20single%20population-1.png" width="700"></p>
<p>Now let’s try addressing the question of whether short time series bias our estimates of autocorrelation in red noise populations. We can do this by simulating populations along a range of time series lengths and noise color. Let’s try a full range from blue noise to red noise in the survival vital rate, and a range of time series lengths from five years to a hundred years.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autocorr_sim.html">autocorr_sim</a></span><span class="op">(</span>timesteps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">60</span>, <span class="fl">5</span><span class="op">)</span>, start <span class="op">=</span> <span class="fl">200</span>, survPhi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.25</span>, <span class="op">-</span><span class="fl">0.2</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span><span class="op">)</span>, fecundPhi <span class="op">=</span> <span class="fl">0</span>, survMean <span class="op">=</span> <span class="fl">0.4</span>, survSd <span class="op">=</span> <span class="fl">0.05</span>, fecundMean <span class="op">=</span> <span class="fl">1.8</span>, fecundSd <span class="op">=</span> <span class="fl">0.2</span>, replicates <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">sims</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">timestep</span>, y<span class="op">=</span><span class="va">population</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></pre></div>
<p><img src="noise_files/figure-html/simulate%20many%20populations-1.png" width="700"></p>
<p>Here we see one example of a population simulated by the function.</p>
<p>Now let’s estimate the autocorrelation in each of these simulated populations. There is a utility function <code>autocorrelation</code> in this package that measures temporal autocorrelation at a time lag of 1.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="va">estimates</span> <span class="op">&lt;-</span> <span class="va">sims</span> <span class="op">%&gt;%</span> <span class="fu">map</span><span class="op">(</span><span class="op">~</span><span class="va">.</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>acf.surv <span class="op">=</span> <span class="fu"><a href="../reference/autocorrelation.html">autocorrelation</a></span><span class="op">(</span><span class="va">est_surv</span>, biasCorrection <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span>, keyby <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">survPhi</span>, <span class="va">timesteps</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbindlist</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<p>I find that this format of ggplot displays the estimates by noise color very nicely.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="va">summ2</span> <span class="op">&lt;-</span> <span class="va">estimates</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>lower.ci <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">bar</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">bar</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="va">acf.surv</span><span class="op">)</span><span class="op">)</span>, upper.ci <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">bar</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">bar</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
<span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="va">acf.surv</span><span class="op">)</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">acf.surv</span><span class="op">)</span><span class="op">)</span>, keyby <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">survPhi</span>, <span class="va">timesteps</span><span class="op">)</span><span class="op">]</span>
<span class="co"># Noise color values for the graph in hexadecimal</span>
<span class="va">noise</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#0033FF"</span>, <span class="st">"#3366FF"</span>, <span class="st">"#6699FF"</span>, <span class="st">"#99CCFF"</span>, <span class="st">"#FFFFFF"</span>, <span class="st">"#FF9999"</span>, <span class="st">"#FF6666"</span>,<span class="st">"#FF0000"</span>, <span class="st">"#CC0000"</span><span class="op">)</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">summ2</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">timesteps</span>, y<span class="op">=</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>size<span class="op">=</span><span class="fl">8</span>, <span class="fu">aes</span><span class="op">(</span>color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">survPhi</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
<span class="co"># This creates confidence intervals around the autocorrelations  </span>
<span class="fu">geom_pointrange</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin<span class="op">=</span><span class="va">lower.ci</span>, ymax<span class="op">=</span><span class="va">upper.ci</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co"># Adds a line for the true autocorrelation value</span>
  <span class="fu">geom_hline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>yintercept<span class="op">=</span><span class="va">survPhi</span><span class="op">)</span>, linetype<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
<span class="co"># This facets the plots by true autocorrelation value  </span>
<span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">survPhi</span><span class="op">)</span> <span class="op">+</span> 
<span class="co"># This increases the font size and labels everything nicely  </span>
  <span class="fu">theme</span><span class="op">(</span>text<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">13</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Time series lengths"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Estimated Autocorrelation"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_colour_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">noise</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>color<span class="op">=</span><span class="st">"Noise color"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Bias in estimates of autocorrelation of survival"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_y_continuous</span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.1</span>, <span class="fl">1.2</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="noise_files/figure-html/plotting%20estimates-1.png" width="768"> We can see here that autocorrelation estimates are biased negative at short time lengths, especially for populations with positive temporal autocorrelation - when the time series is only 5 timesteps, all of the red noise populations read as white noise populations. When autocorrelation is strongly negative, as in the population at -0.5, short time lengths are slightly positively biased. This matches the findings of M. Kendall in his volume <em>Time-Series</em>, where he showed that there is a bias in autocorrelation estimates such that</p>
<p><span class="math display">\[ \hat{\phi} = \phi - \frac{1 + 3\phi}{T - 1} \]</span> where is the autocorrelation and T is the length of the time series.</p>
<div id="correcting-the-bias" class="section level3">
<h3 class="hasAnchor">
<a href="#correcting-the-bias" class="anchor"></a>Correcting the bias</h3>
<p>Here is what the autocorrelation estimates look like when I turn on the bias correction in the autocorrelation function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="va">summ3</span> <span class="op">&lt;-</span> <span class="va">sims</span> <span class="op">%&gt;%</span> <span class="fu">map</span><span class="op">(</span><span class="op">~</span><span class="va">.</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>acf.surv <span class="op">=</span> <span class="fu"><a href="../reference/autocorrelation.html">autocorrelation</a></span><span class="op">(</span><span class="va">est_surv</span>, biasCorrection <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, keyby <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">survPhi</span>, <span class="va">timesteps</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbindlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">.</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>lower.ci <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">bar</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">bar</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="va">acf.surv</span><span class="op">)</span><span class="op">)</span>, upper.ci <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">bar</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">bar</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
<span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="va">acf.surv</span><span class="op">)</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">acf.surv</span><span class="op">)</span><span class="op">)</span>, keyby <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">survPhi</span>, <span class="va">timesteps</span><span class="op">)</span><span class="op">]</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">summ3</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">timesteps</span>, y<span class="op">=</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span>size<span class="op">=</span><span class="fl">8</span>, <span class="fu">aes</span><span class="op">(</span>color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">survPhi</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_pointrange</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin<span class="op">=</span><span class="va">lower.ci</span>, ymax<span class="op">=</span><span class="va">upper.ci</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_hline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>yintercept<span class="op">=</span><span class="va">survPhi</span><span class="op">)</span>, linetype<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">survPhi</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>text<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">13</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Time series lengths"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Estimated Autocorrelation"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_colour_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">noise</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>color<span class="op">=</span><span class="st">"Noise color"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Bias in estimates of autocorrelation of survival"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.1</span>, <span class="fl">1.2</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 1 rows containing missing values (geom_segment).</span></pre></div>
<p><img src="noise_files/figure-html/bias%20correction-1.png" width="700"> The estimates are no longer biased for short time series, though they do become less precise with the bias correction.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Julia Pilowsky.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
